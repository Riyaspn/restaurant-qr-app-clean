// middleware.ts
import { Ratelimit } from '@upstash/ratelimit';
import { kv } from '@vercel/kv';

const rateLimit = new Ratelimit({
  redis: kv,
  limiter: Ratelimit.slidingWindow(10, '60 s') // 10 requests per minute
});

export default async function middleware(request) {
  const ip = request.ip || '127.0.0.1';
  const { success } = await rateLimit.limit(ip);
  
  if (!success) {
    return new Response('Too Many Requests', { status: 429 });
  }
  
  return NextResponse.next();
}

export const config = {
  matcher: ['/api/orders/:path*', '/api/payment/:path*']
};
